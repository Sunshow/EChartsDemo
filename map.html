<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <script src="js/lib/jquery.min.js"></script>
        <!-- 引入 ECharts 文件 -->
        <script src="js/dist/echarts.min.js"></script>
        <script src="js/map/china.js"></script>
    </head>
    <body>
        <style>
            html, body, #main {
                width: 100%;
                height: 100%;
                margin: 0;
            }
        </style>
        <div id="main"></div>
        <script type="text/javascript">
           var originalData = [
               {name: '海门', value: 90},
               {name: '鄂尔多斯', value: 120},
               {name: '招远', value: 120},
               {name: '舟山', value: 120},
               {name: '齐齐哈尔', value: 140}
           ];
           var geoCoordMap = {
               '海门':[121.15,31.89],
               '鄂尔多斯':[109.781327,39.608266],
               '招远':[120.38,37.35],
               '舟山':[122.207216,29.985295],
               '齐齐哈尔':[123.97,47.33],
               '盐城':[120.13,33.38],
               '赤峰':[118.87,42.28],
               '青岛':[120.33,36.07],
               '乳山':[121.52,36.89]
           };

           var convertData = function (data) {
               var res = [];
               for (var i = 0; i < data.length; i++) {
                   var geoCoord = geoCoordMap[data[i].name];
                   if (geoCoord) {
                       res.push({
                           name: data[i].name,
                           value: geoCoord.concat(data[i].value)
                       });
                   }
               }
               return res;
           };

           var option = {
               aria: {
                   show: true
               },
               tooltip: {},
               geo: {
                   map: 'china',
                   roam: true,
                   label: {
                       normal: {
                           show: true,
                           textStyle: {
                               color: 'rgba(0,0,0,0.4)'
                           }
                       }
                   },
                   itemStyle: {
                       normal:{
                           borderColor: 'rgba(0, 0, 0, 0.2)'
                       },
                       emphasis:{
                           color: null,
                           areaColor: null,
                           shadowOffsetX: 0,
                           shadowOffsetY: 0,
                           shadowBlur: 20,
                           borderWidth: 0,
                           shadowColor: 'rgba(0, 0, 0, 0.5)'
                       }
                   }
               },
               series : [
                  {
                      name: 'pm2.5',
                      type: 'effectScatter',
                      coordinateSystem: 'geo',
                      data: convertData(originalData),
                      symbolSize: function (val) {
                          return val[2] / 10;
                      },
                      label: {
                          normal: {
                              formatter: '{b}',
                              position: 'right',
                              show: false
                          },
                          emphasis: {
                              show: true
                          }
                      },
                      itemStyle: {
                          normal: {
                              color: '#ddb926'
                          }
                      }
                   }

               ]
           };

           var chart = echarts.init(document.getElementById('main'));
           chart.setOption(option);


           /*
           chart.on('click', function (param) {
               alert('asdf');
           });
           */
           setTimeout(function () {
                   console.log('change data');
                   originalData.push({name: '盐城', value: 150});
                   chart.setOption({
                       series: [{
                           data: convertData(originalData)
                       }]
                   });
           }, 5000);
        </script>
    </body>
</html>
